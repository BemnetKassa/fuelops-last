// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(cuid())
  name          String
  email         String         @unique
  phone         String         @unique
  password      String
  role          Role           @default(DRIVER)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  driverProfile DriverProfile?
  vehicles      Vehicle[]
  fuelRecords   FuelRecord[]
  reservations  Reservation[]
}

model DriverProfile {
  id                  String   @id @default(cuid())
  userId              String   @unique
  user                User     @relation(fields: [userId], references: [id])
  accountStatus       Status   @default(ACTIVE)
  dailyQuotaTotal     Int      @default(30) // Default total quota in liters
  dailyQuotaRemaining Int      @default(30) // Default remaining quota in liters
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model Vehicle {
  id          String   @id @default(cuid())
  plateNumber String   @unique
  fuelType    FuelType
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Station {
  id           String        @id @default(cuid())
  name         String
  latitude     Float
  longitude    Float
  fuelLevels   Json // Example: { "petrol": 5000, "diesel": 8000 }
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  fuelRecords  FuelRecord[]
  reservations Reservation[]
}

model FuelRecord {
  id        String   @id @default(cuid())
  liters    Float
  amount    Float
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  stationId String
  station   Station  @relation(fields: [stationId], references: [id])
  createdAt DateTime @default(now())
}

model Reservation {
  id         String            @id @default(cuid())
  fuelAmount Float
  status     ReservationStatus @default(PENDING)
  expiresAt  DateTime
  driverId   String
  driver     User              @relation(fields: [driverId], references: [id])
  stationId  String
  station    Station           @relation(fields: [stationId], references: [id])
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
}

enum Role {
  DRIVER
  OWNER
  ADMIN
  STATION_ATTENDANT
}

enum Status {
  ACTIVE
  SUSPENDED
  DEACTIVATED
}

enum FuelType {
  PETROL
  DIESEL
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  COMPLETED
  EXPIRED
  CANCELLED
}
